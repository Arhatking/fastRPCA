function [L,S,errHist] = solver_split_SPCP(X,params,min_func_opts)
tic;

[m, n]   = size(X);
params.m = m;
params.n = n;

errFcn = setOpts(params,'errFcn',[]);
k      = setOpts(params,'k',10);
U0     = setOpts(params,'U0',randn(m,k));
V0     = setOpts(params,'V0',randn(n,k));
gpu    = setOpts(params,'gpu',0);

if ~isfield(params, 'lambdaS')
    params.lambdaS = 0.8;
elseif isempty(params.lambdaS)
    params.lambdaS = 0.8;
end

if ~isfield(params, 'lambdaL')
    params.lambdaS = 115;
elseif isempty(params.lambdaL)
    params.lambdaS = ;
end
    
lambdaS = setOpts( params, 'lambdaS', 0.8 );
lambdaL = setOpts( params, 'lambdaL', 115 );

params.

if strcmp(class(X), 'gpuArray')
	gpu = 1;
end

if gpu
    U0 = gpuArray(U0);
    V0 = gpuArray(V0);
end

R = [vec(U0); vec(V0)];

ObjFunc = @(x)BurMontRPCA(x,X,params,errFcn);

BurMontRPCA();
min_func_opts.gpu = gpu;

[x,~,~] = lbfgs_gpu(ObjFunc,R,min_func_opts);

errHist=BurMontRPCA();
if ~isempty( errHist )
    figure;
    semilogy( errHist );
end

U = reshape(x(1:m*k),m,k);
V = reshape(x(m*k+1:m*k+k*n),n,k);
S = BurMontRPCA(x,X,params,'S');
S = reshape(S,m,n);

L = U*V';

end



function out = setOpts(options, opt, default)
    if isfield(options, opt)
        out = options.(opt);
    else
        out = default;
    end
end